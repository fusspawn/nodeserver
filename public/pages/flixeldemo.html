<html>
	<head>
		<title> Jixel Demo :: Fusspawn Style </title>
		
		<link type="text/css" rel="stylesheet" href="../../css/ui-lightness/jquery-ui.css"/>
		<link href='http://fonts.googleapis.com/css?family=Geo' rel='stylesheet' type='text/css'/>
        <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquery-ui.js"></script>
        <script type="text/javascript" src="../../js/mootools-min.js"></script>
		<script type="text/javascript" src="../../jixel.js"></script>
	</head>
	<body>
		<canvas id="gamewindow"> No Canvas Support in your browser, go try chrome. </canvas>
	</body>
</html>

<script type="text/javascript">
		Number.prototype.clamp = function(min, max) {
		  return Math.min(Math.max(this, min), max);
		}
		
	 $(function() {
			var canvas = $("#gamewindow")[0];
			canvas.getContext("2d");
			
			var JixelInstance = new Jixel(canvas);
			
			JixelInstance.changeScale(2);
			JixelInstance.screenWidth(window.innerWidth);
			JixelInstance.screenHeight(window.innerHeight);
			
			var assets = {
				"ship":["image", "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABn0lEQVRoQ2NkYGD4D8RDFjCOemCA4240BibOr2RgYASFAwTkJ7ThjZMTt1cA1SOUWKhEUBSHFMfAqAdGY4DCeqB3fi5KHihOmIQ3TR+8PQ1Fvb1K5sDmgVEPjMYAhXmgY34iSrlekTAfb5redbsNudpgcFWpGtg8MOqB0RigMA9QlICpoJnithAV3ECREaMeoCj4qKCZYAxEpXgDm++IBvzSOVuoYC1uI0htno96gNrRMRoDbub6KO11OXFRlLaOnIQwMNAReaI2Pgw1EvhEUPmf3qDxX6OYv+/Oc5S20cMXr4F8hPmPXrxCsa9uxnIU8zDywKgHRmOAwiREaqny//h6ivIAo1sqqVbizwOkmjbqgdEYINAfSHEzQSmH5YQFUOqFlCjQ2CbSYCe3EAqX4ctbVPnP71BS6fW7N5F1Mzx89R6lHkiYuBpvqibYFhr1wGgMkJiE3LS0UNoqu65eJbVkpar6Jj8/FPfUbdxIoC006gGqRgDDyIsB6oYf7U0jWA/Q3gmU2TDqAcrCj3LdozFAeRhSZsJoDFAWfpTrBgA+VDgQVkJr3QAAAABJRU5ErkJggg=="]
			};
			
			JixelInstance.am.load(assets, function() {
				var player = new ShipController(JixelInstance.am.get("ship"), 50, 50);
				JixelInstance.state.add(player);
				JixelInstance.follow(player);
				JixelInstance.start();
				JixelInstance.showFPS();
			});
			
			
			
			
			var ShipController = new Class({
				Extends: JxlSprite,
				initialize: function(graphic, x, y) {
				
					  this.parent(graphic, x, y);
					  this.rotatespeed = 5;
					  this.movespeed = 0;
					  this.angle = 90;
					  this.maxspeed = 1.2;
					  this.trail = new JxlEmitter(this.x, this.y);
					  this.forward = {};
					  this.forward.x = this.x;
					  this.forward.y = this.y;
					  this.max_trail_particles = 50;
					  
					  for(i = 0; i < this.max_trail_particles; i++)
					  {
							var particle = new JxlParticle(1);
							particle.createGraphic(4, 4, Math.floor(Math.random() * 0xFFFFFFFF));
							this.trail.add(particle);
					  }
				},
				
				update: function(game, time) {
				  this.controlmove(game, time);
				  this.update_trail(game, time);
				  this.parent(game, time);
				},
				
				update_trail: function(game, time) {
					this.trail.x = this.x;
					this.trail.y = this.y;
					this.trail.setXSpeed(-1*this.forward.x, -1*this.forward.x);
					this.trail.setYSpeed(-1*this.forward.y, -1*this.forward.y);
				},
				
				controlmove: function(game, time) {
					if("A" in game.keys) {
						this.angle += -1*this.rotatespeed;
						this.angle.clamp(0, 360);
					}
					if("D" in game.keys) {
						this.angle += this.rotatespeed;
						this.angle.clamp(0, 360);
					}
					if("W" in game.keys) {
						this.movespeed += 1;
						this.trail.emitParticle();
					}
					if("S" in game.keys) {
					    this.movespeed +=  -1;
						this.trail.emitParticle();
					}
					
					console.log("Time Elapsed: " + time);
					
					this.movespeed.clamp(-this.maxspeed, this.maxspeed);
					this.velocity.x += Math.sin(this.angle * (Math.PI / 180)) * (this.movespeed / 1);
					this.velocity.y -= Math.cos(this.angle * (Math.PI / 180)) * (this.movespeed / 1);
					this.forward.x = this.x += Math.sin(this.angle * (Math.PI / 180)) * this.movespeed;
					this.forward.y = this.y -= Math.cos(this.angle * (Math.PI / 180)) * this.movespeed;
				}
				
			});
	 });
</script>